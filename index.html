<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <title>Server-sent events demo</title>
   <link rel="manifest" href="manifest.json">
</head>
<body>


    <h1>¡Hola!</h1>
    
     <button id="enviarntf" name="enviarntf" >ENVIAR NOTIFICACION</button>
    <button id="btnNotificacion" name="btnNotificacion">PERMISOS NOTIFICACION</button>
    <a href="mailto:">as</a>

  <ul>
  </ul>

<script>

     var btnNotificacion = document.getElementById('btnNotificacion');
     if(btnNotificacion) btnNotificacion.addEventListener('click', permisosNotificacion);

   function permisosNotificacion(){
    Notification.requestPermission().then( function () {
        if ( Notification.permission === "denied" || Notification.permission === "default") {
            btnNotificacion.classList.add("fa-bell-slash")
            alert("Notificaciones deshabilitadas")
          }
        
        else {
            btnNotificacion.classList.remove("fa-bell-slash")
            alert("Las notificaciones están habilitadas")
          }
      });
}

     function askNotificationPermission() {

    alert("Boton de notificacion presionado")

    if (Notification.permission === 'granted') {
         try {
                  var img = "./i1.png";
                  var text = 'ESTE ES EL MENSAJE DE LA NOTIFICACION';
                 new Notification("Solicitud de autos", {
                     body: text,
                     icon: img,
                 });
             } catch (error) {
                     console.log(error);
                 }
     }
 
     else console.log("Las notificaciones están habilitadas")
  return true;
}

  //evtSource.addEventListener("ping", function(e) {
  //   var newElement = document.createElement("li");
  //
  //   var obj = JSON.parse(e.data);
  //   newElement.innerHTML = "ping at " + obj.time;
  //   eventList.appendChild(newElement);
  // }, false);



  if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js')
      .then((registration) => {
        console.log('Service Worker registered with scope:', registration.scope);
         return navigator.serviceWorker.ready;
      }).then(function(registration) {
                console.log('Service Worker listo:', registration);

                // Configurar el botón para mostrar una notificación
                document.getElementById('enviarntf').addEventListener('click', function() {
                    if (Notification.permission === 'granted') {
                        // Enviar un mensaje al service worker para mostrar una notificación
                        registration.active.postMessage({
                            action: 'showNotification',
                            title: 'Simple Title',
                            body: 'Simple piece of body text.\nSecond line of body text :)'
                        });
                    } 
                  }) 
                } 
      )
      .catch((error) => {
        console.log('Service Worker registration failed:', error);
      });
  });
}
</script>
</body>
</html>
